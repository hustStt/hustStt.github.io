---
title: 网络
date: 2020-03-02 00:01:05
tags:
---

## 网络相关
### 网卡名称
+ 如果是复制的虚拟机，经常会出现网卡名称不为eth0的情况，那么如何修改网卡名称呢。
1. 可以通过删除 70‐persistent‐net.rules 文件来实现。

```
rm /etc/udev/rules.d/70‐persistent‐net.rules
reboot
```

2. 修改 70‐persistent‐net.rules 文件。

+ 如果网卡没有启动，使用命令：

```
sudo ip link set eth0 up
//down
```
<!-- more -->
## 配置IP地址
+ ip address显示地址

```
sudo ip address add 192.168.1.1/24 dev eth0 //添加IP
sudo ip address del 192.168.1.1/24 dev eth0 //删除IP
```

+ 永久添加IP地址： 修改/etc/network.conf

## 增加路由

+ ip route 显示路由
```
ip route add {NETWORK/MASK} via {GATEWAYIP}

sudo ip route add 192.168.1.0/24 dev eth0
sudo ip route del 192.168.1.0/24 dev eth0
```

+ 增加默认路由

```
ip route add default via 192.168.0.196
```

### net方式 同时访问内外网
+ 3台虚拟主机 PC1 PC2 PC3；对于PC1配置三个网卡eth0、eth1、eth2，eth0通过nat共享方式共享主机ip可以上网。eth1与PC2的eth0连接，eth2与PC3的eth0连接。


主机 | 网卡 | IP | 网关
---|---|---|---
PC1 | eth0 | ----
PC1 | eth1 | 192.168.1.1/24 | ---
PC1 | eth1 | 192.168.1.1/24 | ---
PC2 | eth0 | 192.168.1.2/24 | 192.168.1.1
PC3 | eth0 | 192.168.2.2/24 | 192.168.2.1

1. 配置好IP以及网关后，此时PC1与PC2、PC3可以ping通，但是PC2和PC3之间显然不能ping通。
2. 开启PC1的转发功能：
```
echo "1" > /proc/sys/net/ipv4/ip_forward
```
3. 转发开启后，3台主机可以互相通信。但此时PC2和PC3不能访问外网。可以通过NAT方式使得内网的2个网段均可上网。
4. 需要设置转发链（FORWARD）成可接受的（ACCEPT）目的地，因此所有通过主机的数据包将会被正确的处理。
```
iptables -F
iptables -P INPUT ACCEPT
iptables -P FORWARD ACCEPT
iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE #打开NAT
```
